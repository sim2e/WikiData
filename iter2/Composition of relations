In the mathematics of binary relations, the composition of relations is the forming of a new binary relation R; S from two given binary relations R and S. In the calculus of relations, the composition of relations is called relative multiplication, and its result is called a relative product.: 40  Function composition is the special case of composition of relations where all relations involved are functions.
The word uncle indicates a compound relation: for a person to be an uncle, he must be the brother of a parent. In algebraic logic it is said that the relation of Uncle (
  
    
      
        x
        U
        z
      
    
    {\displaystyle xUz}
  ) is the composition of relations "is a brother of" (
  
    
      
        x
        B
        y
      
    
    {\displaystyle xBy}
  ) and "is a parent of" (
  
    
      
        y
        P
        z
      
    
    {\displaystyle yPz}
  ).

Beginning with Augustus De Morgan, the traditional form of reasoning by syllogism has been subsumed by relational logical expressions and their composition.

Definition
If 
  
    
      
        R
        ⊆
        X
        ×
        Y
      
    
    {\displaystyle R\subseteq X\times Y}
   and 
  
    
      
        S
        ⊆
        Y
        ×
        Z
      
    
    {\displaystyle S\subseteq Y\times Z}
   are two binary relations, then
their composition 
  
    
      
        R
        ;
        S
      
    
    {\displaystyle R;S}
   is the relation

In other words, 
  
    
      
        R
        ;
        S
        ⊆
        X
        ×
        Z
      
    
    {\displaystyle R;S\subseteq X\times Z}
   is defined by the rule that says 
  
    
      
        (
        x
        ,
        z
        )
        ∈
        R
        ;
        S
      
    
    {\displaystyle (x,z)\in R;S}
   if and only if there is an element 
  
    
      
        y
        ∈
        Y
      
    
    {\displaystyle y\in Y}
   such that 
  
    
      
        x
        
        R
        
        y
        
        S
        
        z
      
    
    {\displaystyle x\,R\,y\,S\,z}
   (that is,  
  
    
      
        (
        x
        ,
        y
        )
        ∈
        R
      
    
    {\displaystyle (x,y)\in R}
   and 
  
    
      
        (
        y
        ,
        z
        )
        ∈
        S
      
    
    {\displaystyle (y,z)\in S}
  ).: 13

Notational variations
The semicolon as an infix notation for composition of relations dates back to Ernst Schroder's textbook of 1895. Gunther Schmidt has renewed the use of the semicolon, particularly in Relational Mathematics (2011).: 40  The use of semicolon coincides with the notation for function composition used (mostly by computer scientists) in category theory, as well as the notation for dynamic conjunction within linguistic dynamic semantics.A small circle 
  
    
      
        (
        R
        ∘
        S
        )
      
    
    {\displaystyle (R\circ S)}
   has been used for the infix notation of composition of relations by John M. Howie in his books considering semigroups of relations. However, the small circle is widely used to represent composition of functions 
  
    
      
        g
        (
        f
        (
        x
        )
        )
        =
        (
        g
        ∘
        f
        )
        (
        x
        )
      
    
    {\displaystyle g(f(x))=(g\circ f)(x)}
   which reverses the text sequence from the operation sequence. The small circle was used in the introductory pages of Graphs and Relations: 18  until it was dropped in favor of juxtaposition (no infix notation). Juxtaposition 
  
    
      
        (
        R
        S
        )
      
    
    {\displaystyle (RS)}
   is commonly used in algebra to signify multiplication, so too, it can signify relative multiplication.
Further with the circle notation, subscripts may be used. Some authors prefer to write 
  
    
      
        
          ∘
          
            l
          
        
      
    
    {\displaystyle \circ _{l}}
   and 
  
    
      
        
          ∘
          
            r
          
        
      
    
    {\displaystyle \circ _{r}}
   explicitly when necessary, depending whether the left or the right relation is the first one applied. A further variation encountered in computer science is the Z notation: 
  
    
      
        ∘
      
    
    {\displaystyle \circ }
   is used to denote the traditional (right) composition, but ⨾ (U+2A3E ⨾ Z NOTATION RELATIONAL COMPOSITION) denotes left composition.

Mathematical generalizations
Binary relations 
  
    
      
        R
        ⊆
        X
        ×
        Y
      
    
    {\displaystyle R\subseteq X\times Y}
   are morphisms 
  
    
      
        R
        :
        X
        →
        Y
      
    
    {\displaystyle R:X\to Y}
   in the category 
  
    
      
        
          
            R
            e
            l
          
        
      
    
    {\displaystyle {\mathsf {Rel}}}
  . In Rel the objects are sets, the morphisms are binary relations and the composition of morphisms is exactly composition of relations as defined above. The category Set of sets and functions is a subcategory of 
  
    
      
        
          
            R
            e
            l
          
        
      
    
    {\displaystyle {\mathsf {Rel}}}
   where the maps  

  
    
      
        X
        →
        Y
      
    
    {\displaystyle X\to Y}
   are functions 
  
    
      
        f
        :
        X
        →
        Y
      
    
    {\displaystyle f:X\to Y}
  .
Given a regular category 
  
    
      
        
          X
        
      
    
    {\displaystyle \mathbb {X} }
  , its category of internal relations 
  
    
      
        
          
            R
            e
            l
          
        
        (
        
          X
        
        )
      
    
    {\displaystyle {\mathsf {Rel}}(\mathbb {X} )}
   has the same objects as  
  
    
      
        
          X
        
      
    
    {\displaystyle \mathbb {X} }
  , but now the  morphisms  
  
    
      
        X
        →
        Y
      
    
    {\displaystyle X\to Y}
   are given by subobjects 
  
    
      
        R
        ⊆
        X
        ×
        Y
      
    
    {\displaystyle R\subseteq X\times Y}
   in 
  
    
      
        
          X
        
      
    
    {\displaystyle \mathbb {X} }
  .  Formally, these are jointly monic spans between 
  
    
      
        X
      
    
    {\displaystyle X}
   and 
  
    
      
        Y
      
    
    {\displaystyle Y}
  . Categories of internal relations are allegories.  In particular 
  
    
      
        
          
            R
            e
            l
          
        
        (
        
          
            S
            e
            t
          
        
        )
        ≅
        
          
            R
            e
            l
          
        
      
    
    {\displaystyle {\mathsf {Rel}}({\mathsf {Set}})\cong {\mathsf {Rel}}}
  . Given a field 
  
    
      
        k
      
    
    {\displaystyle k}
   (or more generally a principal ideal domain), the category of relations internal to matrices over 
  
    
      
        k
      
    
    {\displaystyle k}
  , 
  
    
      
        
          
            R
            e
            l
          
        
        (
        
          
            M
            a
            t
          
        
        (
        k
        )
        )
      
    
    {\displaystyle {\mathsf {Rel}}({\mathsf {Mat}}(k))}
   has morphisms 
  
    
      
        n
        →
        m
      
    
    {\displaystyle n\to m}
   linear subspaces 
  
    
      
        R
        ⊆
        
          k
          
            n
          
        
        ⊕
        
          k
          
            m
          
        
      
    
    {\displaystyle R\subseteq k^{n}\oplus k^{m}}
  .  The category of linear relations over the finite field 
  
    
      
        
          
            F
          
          
            2
          
        
      
    
    {\displaystyle \mathbb {F} _{2}}
   is isomorphic to the phase-free qubit ZX-calculus modulo scalars.

Properties
Composition of relations is associative: 
  
    
      
        R
        ;
        (
        S
        ;
        T
        )
        =
        (
        R
        ;
        S
        )
        ;
        T
        .
      
    
    {\displaystyle R;(S;T)=(R;S);T.}
  
The converse relation of 
  
    
      
        R
        
        ;
        S
      
    
    {\displaystyle R\,;S}
   is 
  
    
      
        (
        R
        
        ;
        S
        
          )
          
            
              T
            
          
        
        =
        
          S
          
            
              T
            
          
        
        
        ;
        
          R
          
            
              T
            
          
        
        .
      
    
    {\displaystyle (R\,;S)^{\textsf {T}}=S^{\textsf {T}}\,;R^{\textsf {T}}.}
   This property makes the set of all binary relations on a set a semigroup with involution.
The composition of (partial) functions (that is, functional relations) is again a (partial) function.
If 
  
    
      
        R
      
    
    {\displaystyle R}
   and 
  
    
      
        S
      
    
    {\displaystyle S}
   are injective, then 
  
    
      
        R
        
        ;
        S
      
    
    {\displaystyle R\,;S}
   is injective, which conversely implies only the injectivity of 
  
    
      
        R
        .
      
    
    {\displaystyle R.}
  
If 
  
    
      
        R
      
    
    {\displaystyle R}
   and 
  
    
      
        S
      
    
    {\displaystyle S}
   are surjective, then 
  
    
      
        R
        
        ;
        S
      
    
    {\displaystyle R\,;S}
   is surjective, which conversely implies only the surjectivity of 
  
    
      
        S
        .
      
    
    {\displaystyle S.}
  
The set of binary relations on a set 
  
    
      
        X
      
    
    {\displaystyle X}
   (that is, relations from 
  
    
      
        X
      
    
    {\displaystyle X}
   to 
  
    
      
        X
      
    
    {\displaystyle X}
  ) together with (left or right) relation composition forms a monoid with zero, where the identity map on 
  
    
      
        X
      
    
    {\displaystyle X}
   is the neutral element, and the empty set is the zero element.

Composition in terms of matrices
Finite binary relations are represented by logical matrices. The entries of these matrices are either zero or one, depending on whether the relation represented is false or true for the row and column corresponding to compared objects. Working with such matrices involves the Boolean arithmetic with 
  
    
      
        1
        +
        1
        =
        1
      
    
    {\displaystyle 1+1=1}
   and 
  
    
      
        1
        ×
        1
        =
        1.
      
    
    {\displaystyle 1\times 1=1.}
   An entry in the matrix product of two logical matrices will be 1, then, only if the row and column multiplied have a corresponding 1. Thus the logical matrix of a composition of relations can be found by computing the matrix product of the matrices representing the factors of the composition. "Matrices constitute a method for computing the conclusions traditionally drawn by means of hypothetical syllogisms and sorites."

Heterogeneous relations
Consider a heterogeneous relation 
  
    
      
        R
        ⊆
        A
        ×
        B
        ;
      
    
    {\displaystyle R\subseteq A\times B;}
   that is, where 
  
    
      
        A
      
    
    {\displaystyle A}
   and 
  
    
      
        B
      
    
    {\displaystyle B}
   are distinct sets. Then using composition of relation 
  
    
      
        R
      
    
    {\displaystyle R}
   with its converse 
  
    
      
        
          R
          
            
              T
            
          
        
        ,
      
    
    {\displaystyle R^{\textsf {T}},}
   there are homogeneous relations 
  
    
      
        R
        
          R
          
            
              T
            
          
        
      
    
    {\displaystyle RR^{\textsf {T}}}
   (on 
  
    
      
        A
      
    
    {\displaystyle A}
  ) and 
  
    
      
        
          R
          
            
              T
            
          
        
        R
      
    
    {\displaystyle R^{\textsf {T}}R}
   (on 
  
    
      
        B
      
    
    {\displaystyle B}
  ).
If for all 
  
    
      
        x
        ∈
        A
      
    
    {\displaystyle x\in A}
   there exists some 
  
    
      
        y
        ∈
        B
        ,
      
    
    {\displaystyle y\in B,}
   such that 
  
    
      
        x
        R
        y
      
    
    {\displaystyle xRy}
   (that is, 
  
    
      
        R
      
    
    {\displaystyle R}
   is a (left-)total relation), then for all 
  
    
      
        x
        ,
        x
        R
        
          R
          
            
              T
            
          
        
        x
      
    
    {\displaystyle x,xRR^{\textsf {T}}x}
   so that 
  
    
      
        R
        
          R
          
            
              T
            
          
        
      
    
    {\displaystyle RR^{\textsf {T}}}
   is a reflexive relation or 
  
    
      
        I
        ⊆
        R
        
          R
          
            
              T
            
          
        
      
    
    {\displaystyle I\subseteq RR^{\textsf {T}}}
   where I is the identity relation 
  
    
      
        {
        x
        I
        x
        :
        x
        ∈
        A
        }
        .
      
    
    {\displaystyle \{xIx:x\in A\}.}
   Similarly, if 
  
    
      
        R
      
    
    {\displaystyle R}
   is a surjective relation then 
 
In this case 
  
    
      
        R
        ⊆
        R
        
          R
          
            
              T
            
          
        
        R
        .
      
    
    {\displaystyle R\subseteq RR^{\textsf {T}}R.}
   The opposite inclusion occurs for a difunctional relation.
The composition 
  
    
      
        
          
            
              
                R
                ¯
              
            
          
          
            
              T
            
          
        
        R
      
    
    {\displaystyle {\bar {R}}^{\textsf {T}}R}
   is used to distinguish relations of Ferrer's type, which satisfy 
  
    
      
        R
        
          
            
              
                R
                ¯
              
            
          
          
            
              T
            
          
        
        R
        =
        R
        .
      
    
    {\displaystyle R{\bar {R}}^{\textsf {T}}R=R.}

Example
Let 
  
    
      
        A
        =
      
    
    {\displaystyle A=}
   { France, Germany, Italy, Switzerland } and 
  
    
      
        B
        =
      
    
    {\displaystyle B=}
   { French, German, Italian } with the relation 
  
    
      
        R
      
    
    {\displaystyle R}
   given by 
  
    
      
        a
        R
        b
      
    
    {\displaystyle aRb}
   when 
  
    
      
        b
      
    
    {\displaystyle b}
   is a national language of 
  
    
      
        a
        .
      
    
    {\displaystyle a.}
  
Since both 
  
    
      
        A
      
    
    {\displaystyle A}
   and 
  
    
      
        B
      
    
    {\displaystyle B}
   is finite, 
  
    
      
        R
      
    
    {\displaystyle R}
   can be represented by a logical matrix, assuming rows (top to bottom) and columns (left to right) are ordered alphabetically:

The converse relation 
  
    
      
        
          R
          
            
              T
            
          
        
      
    
    {\displaystyle R^{\textsf {T}}}
   corresponds to the transposed matrix, and the relation composition 
  
    
      
        
          R
          
            
              T
            
          
        
        ;
        R
      
    
    {\displaystyle R^{\textsf {T}};R}
   corresponds to the matrix product 
  
    
      
        
          R
          
            
              T
            
          
        
        R
      
    
    {\displaystyle R^{\textsf {T}}R}
   when summation is implemented by logical disjunction. It turns out that the 
  
    
      
        3
        ×
        3
      
    
    {\displaystyle 3\times 3}
   matrix 
  
    
      
        
          R
          
            
              T
            
          
        
        R
      
    
    {\displaystyle R^{\textsf {T}}R}
   contains a 1 at every position, while the reversed matrix product computes as:

This matrix is symmetric, and represents a homogeneous relation on 
  
    
      
        A
        .
      
    
    {\displaystyle A.}
  
Correspondingly, 
  
    
      
        
          R
          
            
              T
            
          
        
        
        ;
        R
      
    
    {\displaystyle R^{\textsf {T}}\,;R}
   is the universal relation on 
  
    
      
        B
        ,
      
    
    {\displaystyle B,}
   hence any two languages share a nation where they both are spoken (in fact: Switzerland).
Vice versa, the question whether two given nations share a language can be answered using 
  
    
      
        R
        
        ;
        
          R
          
            
              T
            
          
        
        .
      
    
    {\displaystyle R\,;R^{\textsf {T}}.}

Schröder rules
For a given set 
  
    
      
        V
        ,
      
    
    {\displaystyle V,}
   the collection of all binary relations on 
  
    
      
        V
      
    
    {\displaystyle V}
   forms a Boolean lattice ordered by inclusion 
  
    
      
        (
        ⊆
        )
        .
      
    
    {\displaystyle (\subseteq ).}
   Recall that complementation reverses inclusion:

  
    
      
        A
        ⊆
        B
        
           implies 
        
        
          B
          
            ∁
          
        
        ⊆
        
          A
          
            ∁
          
        
        .
      
    
    {\displaystyle A\subseteq B{\text{ implies }}B^{\complement }\subseteq A^{\complement }.}
   
In the calculus of relations it is common to represent the complement of a set by an overbar: 
  
    
      
        
          
            
              A
              ¯
            
          
        
        =
        
          A
          
            ∁
          
        
        .
      
    
    {\displaystyle {\bar {A}}=A^{\complement }.}
  
If 
  
    
      
        S
      
    
    {\displaystyle S}
   is a binary relation, let 
  
    
      
        
          S
          
            
              T
            
          
        
      
    
    {\displaystyle S^{\textsf {T}}}
   represent the converse relation, also called the transpose. Then the Schröder rules are

Verbally, one equivalence can be obtained from another: select the first or second factor and transpose it; then complement the other two relations and permute them.: 15–19 Though this transformation of an inclusion of a composition of relations was detailed by Ernst Schröder, in fact Augustus De Morgan first articulated the transformation as Theorem K in 1860. He wrote
With Schröder rules and complementation one can solve for an unknown relation 
  
    
      
        X
      
    
    {\displaystyle X}
   in relation inclusions such as 

For instance, by Schröder rule 
  
    
      
        R
        X
        ⊆
        S
        
           implies 
        
        
          R
          
            
              T
            
          
        
        
          
            
              S
              ¯
            
          
        
        ⊆
        
          
            
              X
              ¯
            
          
        
        ,
      
    
    {\displaystyle RX\subseteq S{\text{ implies }}R^{\textsf {T}}{\bar {S}}\subseteq {\bar {X}},}
   and complementation gives 
  
    
      
        X
        ⊆
        
          
            
              
                R
                
                  
                    T
                  
                
              
              
                
                  
                    S
                    ¯
                  
                
              
            
            ¯
          
        
        ,
      
    
    {\displaystyle X\subseteq {\overline {R^{\textsf {T}}{\bar {S}}}},}
   which is called the left residual of 
  
    
      
        S
      
    
    {\displaystyle S}
   by 
  
    
      
        R
      
    
    {\displaystyle R}
  .

Quotients
Just as composition of relations is a type of multiplication resulting in a product, so some operations compare to division and produce quotients. Three quotients are exhibited here: left residual, right residual, and symmetric quotient. The left residual of two relations is defined presuming that they have the same domain (source), and the right residual presumes the same codomain (range, target). The symmetric quotient presumes two relations share a domain and a codomain.
Definitions:

Left residual: 
  
    
      
        A
        ∖
        B
        
          :=
        
        
          
            
              
                A
                
                  
                    T
                  
                
              
              
                
                  
                    B
                    ¯
                  
                
              
            
            ¯
          
        
      
    
    {\displaystyle A\backslash B\mathrel {:=} {\overline {A^{\textsf {T}}{\bar {B}}}}}
  
Right residual: 
  
    
      
        D
        
          /
        
        C
        
          :=
        
        
          
            
              
                
                  
                    D
                    ¯
                  
                
              
              
                C
                
                  
                    T
                  
                
              
            
            ¯
          
        
      
    
    {\displaystyle D/C\mathrel {:=} {\overline {{\bar {D}}C^{\textsf {T}}}}}
  
Symmetric quotient: 
  
    
      
        syq
        ⁡
        (
        E
        ,
        F
        )
        
          :=
        
        
          
            
              
                E
                
                  
                    T
                  
                
              
              
                
                  
                    F
                    ¯
                  
                
              
            
            ¯
          
        
        ∩
        
          
            
              
                
                  
                    
                      E
                      ¯
                    
                  
                
                
                  
                    T
                  
                
              
              F
            
            ¯
          
        
      
    
    {\displaystyle \operatorname {syq} (E,F)\mathrel {:=} {\overline {E^{\textsf {T}}{\bar {F}}}}\cap {\overline {{\bar {E}}^{\textsf {T}}F}}}
  Using Schröder's rules, 
  
    
      
        A
        X
        ⊆
        B
      
    
    {\displaystyle AX\subseteq B}
   is equivalent to 
  
    
      
        X
        ⊆
        A
        ∖
        B
        .
      
    
    {\displaystyle X\subseteq A\backslash B.}
   Thus the left residual is the greatest relation satisfying 
  
    
      
        A
        X
        ⊆
        B
        .
      
    
    {\displaystyle AX\subseteq B.}
   Similarly, the inclusion 
  
    
      
        Y
        C
        ⊆
        D
      
    
    {\displaystyle YC\subseteq D}
   is equivalent to 
  
    
      
        Y
        ⊆
        D
        
          /
        
        C
        ,
      
    
    {\displaystyle Y\subseteq D/C,}
   and the right residual is the greatest relation satisfying 
  
    
      
        Y
        C
        ⊆
        D
        .
      
    
    {\displaystyle YC\subseteq D.}
  : 43–6 One can practice the logic of residuals with Sudoku.

Join: another form of composition
A fork operator 
  
    
      
        (
        <
        )
      
    
    {\displaystyle (<)}
   has been introduced to fuse two relations 
  
    
      
        c
        :
        H
        →
        A
      
    
    {\displaystyle c:H\to A}
   and 
  
    
      
        d
        :
        H
        →
        B
      
    
    {\displaystyle d:H\to B}
   into 
  
    
      
        c
        
        (
        <
        )
        
        d
        :
        H
        →
        A
        ×
        B
        .
      
    
    {\displaystyle c\,(<)\,d:H\to A\times B.}
   The construction depends on projections 
  
    
      
        a
        :
        A
        ×
        B
        →
        A
      
    
    {\displaystyle a:A\times B\to A}
   and 
  
    
      
        b
        :
        A
        ×
        B
        →
        B
        ,
      
    
    {\displaystyle b:A\times B\to B,}
   understood as relations, meaning that there are converse relations 
  
    
      
        
          a
          
            
              T
            
          
        
      
    
    {\displaystyle a^{\textsf {T}}}
   and 
  
    
      
        
          b
          
            
              T
            
          
        
        .
      
    
    {\displaystyle b^{\textsf {T}}.}
   Then the fork of 
  
    
      
        c
      
    
    {\displaystyle c}
   and 
  
    
      
        d
      
    
    {\displaystyle d}
   is given by
Another form of composition of relations, which applies to general 
  
    
      
        n
      
    
    {\displaystyle n}
  -place relations for 
  
    
      
        n
        ≥
        2
        ,
      
    
    {\displaystyle n\geq 2,}
   is the join operation of relational algebra. The usual composition of two binary relations as defined here can be obtained by taking their join, leading to a ternary relation, followed by a projection that removes the middle component. For example, in the query language SQL there is the operation Join (SQL).

See also
Demonic composition
Friend of a friend – Human contact that exists because of a mutual friend

Notes
References
M. Kilp, U. Knauer, A.V. Mikhalev (2000) Monoids, Acts and Categories with Applications to Wreath Products and Graphs, De Gruyter Expositions in Mathematics vol. 29, Walter de Gruyter,ISBN 3-11-015248-7.